<%- include('../partials/header') %>
    
  <div class="container">
          
    <form class="bigForm" id="adrForm" action="/adrs/new" method="POST">
      <!--Facility Information-->
      <div>
        <label for="facility_id">Global ID:</label>
        <select type="text" id="facility_id" name="facility[id]">
          <% for (let i=0; i < facilities.length; i++) { %>
            <option value=<%= facilities[i].id %>><%= facilities[i].global_id %></option>
          <% } %>
        </select>
      </div>
      
      <!--Patient Information -->
      <div>
        <label for="patient_id">MRN:</label>
        <select type="text" id="patient_id" name="patient[id]">
          <% for (let i=0; i < patients.length; i++) { %>
            <option value=<%= patients[i].id %>><%= patients[i].mrn %></option>
          <% } %>
        </select>
      </div>
      
      <!--Claim Information-->
      <div>
        <label for="from_date">From Date:</label>
        <input type="date" id="from_date" name="adr[from_date]">
      </div>
      <div>
        <label for="to_date">To Date:</label>
        <input type="date" id="to_date" name="adr[to_date]">
      </div>
      <div>
        <label for="expected_reimbursement">Expected Reimbursement:</label>
        <input type="text" id="expected_reimbursement" name="adr[expected_reimbursement]" step="0.01">
      </div>
      <div>
        <label for="active">Claim Status:</label>
        <select id="active" name="adr[active]">
          <option value=true>Active</option>
          <option value=false>Inactive</option>
        </select>
      <div>
        <label for="mcr_status">Payment Status:</label>
        <select id="mcr_status" name="adr[mcr_status]">
          <option value="denied">Denied</option>
          <option value="partially_denied">Partially Denied</option>
          <option value="paid_in_full">Paid in Full</option>
          <option value="other">Other</option>
        </select>
      </div>
      <br>
      
      <button class="btn btn-primary" id="submitAdr">Submit</button>
    </form>
  </div>
  
  <script>
    
  document.addEventListener('DOMContentLoaded', initiate)
  
  function initiate(){

    const erDiv = document.querySelector("#expected_reimbursement")
    const er80Div = document.querySelector("#expected_reimbursement_80")
    
    const fromDiv = document.querySelector("#from_date")
    const toDiv = document.querySelector("#to_date")
    
    erDiv.addEventListener("input", (event)=>{autoER80(erDiv, er80Div)});
    fromDiv.addEventListener("input", (event)=>{validateClaimMonths(fromDiv, toDiv)});
    toDiv.addEventListener("input", (event)=>{validateClaimMonths(fromDiv, toDiv)});
    // autoER80(erDiv, er80Div)
    
    function autoER80(div1, div2) {
      if (div1.value) {
        div2.value = (0.8*div1.value).toFixed(2)
      } else {
        div2.value = ""
      }
    }
    
    function validateClaimMonths(div1, div2) {
      if (div1.value && div2.value) {
        const date1 = new Date(div1.value);
        const date2 = new Date(div2.value);
        const month1 = date1.getMonth();
        const month2 = date2.getMonth();
        if (month1 === month2) {
          setDivClass(div1, "valid", "invalid");
          setDivClass(div2, "valid", "invalid");
          return true;
        } else {
          setDivClass(div1, "invalid", "valid");
          setDivClass(div2, "invalid", "valid");
          return false;
        }
      }
    }
    
    function setDivClass(div, addClass, delClass) {
      if (div.classList.contains(delClass)) {
        div.classList.remove(delClass);
      }
      div.classList.add(addClass);
    }
    
    function validateLength(value, length) {
      if (value.length===length) {
        return true;
      } else {
        return false;
      }
    }
    
    function validateType(value, type) {
      
    }
  }  
  </script>

<%- include('../partials/footer') %>
